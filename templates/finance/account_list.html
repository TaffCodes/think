{% extends 'base.html' %}

{% block title %}Finance Dashboard | FikiriERP{% endblock %}

{% block content %}
<div class="container-fluid">
  
  <div class="row mb-4 align-items-center">
    <div class="col-md-6">
      <h2 class="mb-0">Finance Dashboard</h2>
    </div>
    <div class="col-md-6 text-md-end mt-3 mt-md-0">
      {% if user.is_staff %}
        <a href="{% url 'project-payment' %}" class="btn btn-success" data-mdb-ripple-init>
          <i class="fas fa-dollar-sign me-2"></i> Receive Project Payment
        </a>
        <a href="{% url 'transaction-create' %}" class="btn btn-primary" data-mdb-ripple-init>
          <i class="fas fa-exchange-alt me-2"></i> Manual Transaction
        </a>
      {% endif %}
      <a href="{% url 'expense-create' %}" class="btn" style="background-color: #e88c1f; color: #fff;" data-mdb-ripple-init>
        <i class="fas fa-plus me-2"></i> Add Expense
      </a>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-7">
      <div class="card shadow-sm border">
        <div class="card-header">
          <h5 class="mb-0">Account Balances</h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Account Name</th>
                  <th class="text-end">Current Balance</th>
                </tr>
              </thead>
              <tbody>
                {% for account in accounts %}
                <tr>
                  <td><strong>{{ account.name }}</strong></td>
                  <td class="text-end">
                    <strong style="color: {% if account.get_balance < 0 %}#c9302c{% else %}#3e4d21{% endif %};">
                      Ksh {{ account.get_balance|floatformat:2 }}
                    </strong>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="2" class="text-center p-4">
                    No accounts found. Please add accounts in the admin panel.
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-5">
      <div class="card shadow-sm border">
        <div class="card-header">
          <h5 class="mb-0">Recent Transactions</h5>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush">
            {% for tx in recent_transactions %}
              <li class="list-group-item">
                <strong>{{ tx.description|truncatewords:10 }}</strong>
                <span class="float-end badge {% if tx.from_account %}badge-danger{% else %}badge-success{% endif %} rounded-pill">
                  Ksh {{ tx.amount|floatformat:2 }}
                </span>
                <small class="d-block text-muted">
                  {{ tx.timestamp|date:"d M Y, P" }}
                </small>
              </li>
            {% empty %}
              <li class="list-group-item text-muted">No transactions recorded yet.</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}